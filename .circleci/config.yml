# This config was automatically generated from your source code
# Stacks detected: deps:node:.
version: 2.1
orbs:
  node: circleci/node@5
jobs:
  deploy:
    docker:
      - image: cimg/base:stable
    steps:
      - when:
        condition:
          equal: [ main ]
      - run:
          name: deploy
          command: ssh -oStrictHostKeyChecking=no -v $USER@$IP "./deploy.sh"
  deploy-pr:
    docker:
      - image: cimg/base:stable
    steps:
      - run:
          name: "set env variable"
          command: export PR_NUMBER=$CIRCLE_PR_NUMBER >> "$BASH_ENV"
      - when:
        and:
            not:
                equal: [ main ]    
      - run:
          name: deploy-pr
          command: ssh -oStrictHostKeyChecking=no -v $USER@$IP "./deploy-pr.sh $PR_NUMBER"
workflows:
  deploy:
    jobs:
      - deploy:
        filters:
            branches:
                only:
                  - main
      - deploy-pr:
        filters:
          branches:
            not:
              only:
                - main